name: Deploy to Cloud Run

on:
  push:
    branches: [ main ]

jobs:

  test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.17

    - name: Test
      run: make test-up

    - name: Showing test result
      if: always()
      run: docker logs app_test

    - name: Clean test
      if: always()
      run: make test-clean
